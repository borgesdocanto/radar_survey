<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluación de Desempeño Inmobiliario</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 1200px;
            width: 100%;
            min-height: 500px;
            position: relative;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .container {
                padding: 30px 20px;
                margin: 10px;
                border-radius: 10px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 25px 15px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .question-text {
                font-size: 1.1em;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 0.9em;
                min-width: 100px;
            }
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .progress-section {
            margin-bottom: 30px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #27ae60);
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-text {
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .question-section {
            text-align: center;
            margin: 40px 0;
        }

        .category-badge {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 20px;
            display: inline-block;
        }

        .question-number {
            font-size: 1.1em;
            color: #7f8c8d;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 1.3em;
            color: #2c3e50;
            margin-bottom: 30px;
            line-height: 1.4;
            font-weight: 500;
        }

        .rating-container {
            margin: 30px 0;
        }

        .rating-scale {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            margin-bottom: 15px;
            max-width: 500px;
            margin: 0 auto 15px auto;
        }

        .rating-item {
            width: 45px;
            height: 45px;
            border: 2px solid #bdc3c7;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            font-size: 1.1em;
            justify-self: center;
        }

        @media (max-width: 768px) {
            .rating-scale {
                grid-template-columns: repeat(5, 1fr);
                gap: 8px;
                max-width: 300px;
            }
            
            .rating-item {
                width: 50px;
                height: 50px;
            }
        }

        @media (max-width: 480px) {
            .rating-scale {
                grid-template-columns: repeat(5, 1fr);
                gap: 6px;
                max-width: 280px;
            }
            
            .rating-item {
                width: 45px;
                height: 45px;
                font-size: 1em;
            }
        }

        .rating-item:hover {
            transform: scale(1.15);
            border-color: #3498db;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .rating-item.selected {
            background: #3498db;
            color: white;
            border-color: #2980b9;
            transform: scale(1.1);
        }

        .rating-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #7f8c8d;
            margin: 15px 20px;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }

        .btn-secondary:hover {
            box-shadow: 0 8px 20px rgba(149, 165, 166, 0.3);
        }

        .results-section {
            text-align: center;
            display: none;
        }

        .results-header {
            margin-bottom: 30px;
        }

        .results-header h2 {
            color: #2c3e50;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .chart-container {
            margin: 30px 0;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            height: 500px;
            position: relative;
        }

        #radarChart {
            max-height: 460px;
        }

        .scores-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            border-radius: 10px;
            font-size: 0.9em;
        }

        .footer a {
            color: #3498db;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer a:hover {
            color: #2980b9;
            text-decoration: underline;
        }

        .score-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .score-card h4 {
            color: #2c3e50;
            font-size: 0.9em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .score-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }

        .score-excellent { color: #27ae60; }
        .score-good { color: #f39c12; }
        .score-needs-improvement { color: #e74c3c; }

        .score-label {
            font-size: 0.8em;
            color: #7f8c8d;
            font-weight: 500;
        }

        .url-section {
            background: #ecf0f1;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }

        .url-section h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .generated-url {
            background: white;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            word-break: break-all;
            border: 1px solid #bdc3c7;
            font-size: 0.9em;
        }

        .actions {
            margin-top: 20px;
            text-align: center;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in {
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Evaluación Inmobiliaria</h1>
            <p>Evalúa tu desempeño paso a paso</p>
        </div>

        <div class="progress-section">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text">
                <span id="progressText">Pregunta 0 de 0</span>
            </div>
        </div>

        <!-- Sección de preguntas -->
        <div class="question-section" id="questionSection">
            <div class="category-badge" id="categoryBadge"></div>
            <div class="question-number" id="questionNumber"></div>
            <div class="question-text" id="questionText"></div>
            
            <div class="rating-container">
                <div class="rating-scale" id="ratingScale">
                    <!-- Los botones de rating se generan dinámicamente -->
                </div>
                <div class="rating-labels">
                    <span>Muy bajo</span>
                    <span>Excelente</span>
                </div>
            </div>

            <div class="navigation">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()" disabled>
                    ← Anterior
                </button>
                <div class="progress-indicator">
                    <span id="questionProgress"></span>
                </div>
            </div>
        </div>

        <!-- Sección de resultados -->
        <div class="results-section" id="resultsSection">
            <div class="results-header">
                <h2>Tus Resultados</h2>
                <p>Análisis de tu desempeño por área</p>
            </div>

            <div class="chart-container">
                <canvas id="radarChart" width="400" height="400"></canvas>
            </div>

            <div class="scores-grid" id="scoresGrid">
                <!-- Los scores se generan dinámicamente -->
            </div>

            <div class="url-section">
                <h3>URL de esta Evaluación</h3>
                <div class="generated-url" id="generatedUrl"></div>
                <div class="actions">
                    <button class="btn" onclick="copyUrl()">📋 Copiar URL</button>
                    <button class="btn btn-secondary" onclick="resetSurvey()">🔄 Nueva Evaluación</button>
                    <button class="btn" onclick="showUrlExamples()" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">📚 Ver Ejemplos de URLs</button>
                </div>
                
                <div id="urlExamples" style="display: none; margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <h4>Ejemplos de URLs Personalizadas:</h4>
                    <div style="margin: 15px 0;">
                        <strong>1. Cambiar nombres de categorías:</strong>
                        <div style="font-family: monospace; background: white; padding: 10px; margin: 5px 0; border-radius: 5px; font-size: 0.8em;">
                            ?names=Ventas,Marketing,Servicio,Finanzas
                        </div>
                    </div>
                    <div style="margin: 15px 0;">
                        <strong>2. Preguntas personalizadas (hasta 12):</strong>
                        <div style="font-family: monospace; background: white; padding: 10px; margin: 5px 0; border-radius: 5px; font-size: 0.8em;">
                            ?t1=¿Dominas las técnicas de venta?&t2=¿Generas leads de calidad?&t3=¿Cierras ventas consistentemente?
                        </div>
                    </div>
                    <div style="margin: 15px 0;">
                        <strong>3. URL completa de ejemplo:</strong>
                        <div style="font-family: monospace; background: white; padding: 10px; margin: 5px 0; border-radius: 5px; font-size: 0.8em;">
                            ?name=Juan+Perez&names=Ventas,Marketing,Servicio&t1=¿Cierras ventas efectivamente?&t2=¿Generas leads de calidad?&t3=¿Brindas excelente servicio?
                        </div>
                    </div>
                    <p style="font-size: 0.9em; color: #7f8c8d; margin-top: 15px;">
                        💡 <strong>Tip:</strong> Combina parámetros para crear encuestas totalmente personalizadas. 
                        Las preguntas se distribuyen automáticamente entre las categorías.
                    </p>
                </div>
            </div>
        </div>

        <!-- Footer con créditos -->
        <div class="footer">
            Herramienta creada por Leandro Borges Do Canto | 
            <a href="https://www.instagram.com/leanborges" target="_blank" rel="noopener noreferrer">@leanborges</a> | 
            <a href="https://www.borges.com.ar" target="_blank" rel="noopener noreferrer">www.borges.com.ar</a>
        </div>
    </div>

    <script>
        // Configuración del sistema
        const defaultSurveyConfig = {
            categories: [
                {
                    key: 'captacion',
                    name: 'Captación de Propiedades',
                    color: '#3498db',
                    questions: [
                        'Tengo una estrategia clara para identificar propiedades con potencial de venta',
                        'Mantengo relaciones sólidas con propietarios que pueden referir nuevas propiedades',
                        'Utilizo múltiples canales para encontrar nuevas propiedades (online, networking, referencias)'
                    ]
                },
                {
                    key: 'leads',
                    name: 'Generación y Gestión de Leads',
                    color: '#27ae60',
                    questions: [
                        'Genero consistentemente nuevos leads calificados cada semana',
                        'Tengo un sistema organizado para dar seguimiento a todos mis leads',
                        'Convierto efectivamente leads fríos en clientes interesados'
                    ]
                },
                {
                    key: 'productividad',
                    name: 'Productividad Personal y del Equipo',
                    color: '#f39c12',
                    questions: [
                        'Gestiono eficientemente mi tiempo y priorizo las actividades de mayor impacto',
                        'Utilizo tecnología y herramientas para optimizar mis procesos de trabajo',
                        'Colaboro efectivamente con mi equipo para maximizar resultados'
                    ]
                },
                {
                    key: 'conversion',
                    name: 'Conversión de Operaciones',
                    color: '#e74c3c',
                    questions: [
                        'Cierro efectivamente las negociaciones y concreto las ventas',
                        'Manejo objeciones de clientes de manera profesional y convincente',
                        'Mantengo una tasa de conversión consistente de prospectos a clientes'
                    ]
                }
            ]
        };

        let surveyConfig = { ...defaultSurveyConfig };

        // Variables globales
        let currentQuestionIndex = 0;
        let responses = {};
        let allQuestions = [];
        let urlParams = {};

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            parseURLParams();
            initializeSurvey();
            showCurrentQuestion();
        });

        // Parsear parámetros de URL
        function parseURLParams() {
            const params = new URLSearchParams(window.location.search);
            urlParams = {};
            
            for (let [key, value] of params) {
                urlParams[key] = decodeURIComponent(value);
            }

            // Cargar configuración personalizada desde URL
            loadCustomSurveyConfig();

            // Cargar respuestas existentes si existen
            if (Object.keys(urlParams).length > 0) {
                loadExistingResponses();
            }
        }

        // Cargar configuración personalizada desde URL
        function loadCustomSurveyConfig() {
            // Si hay nombres de categorías en la URL, usarlos
            if (urlParams.names) {
                const customCategoryNames = urlParams.names.split(',');
                surveyConfig.categories.forEach((category, index) => {
                    if (customCategoryNames[index]) {
                        category.name = customCategoryNames[index].trim();
                    }
                });
            }

            // Si hay preguntas personalizadas en la URL, usarlas
            const customQuestions = [];
            let questionIndex = 1;
            
            while (urlParams[`t${questionIndex}`]) {
                customQuestions.push(urlParams[`t${questionIndex}`]);
                questionIndex++;
            }

            // Si hay preguntas personalizadas, reorganizar las categorías
            if (customQuestions.length > 0) {
                const questionsPerCategory = Math.ceil(customQuestions.length / surveyConfig.categories.length);
                
                surveyConfig.categories.forEach((category, categoryIndex) => {
                    const startIndex = categoryIndex * questionsPerCategory;
                    const endIndex = Math.min(startIndex + questionsPerCategory, customQuestions.length);
                    
                    if (startIndex < customQuestions.length) {
                        category.questions = customQuestions.slice(startIndex, endIndex);
                    }
                });

                // Si hay menos categorías necesarias, ajustar
                const neededCategories = Math.ceil(customQuestions.length / questionsPerCategory);
                if (neededCategories < surveyConfig.categories.length) {
                    surveyConfig.categories = surveyConfig.categories.slice(0, neededCategories);
                }
            }

            console.log('Configuración cargada:', surveyConfig);
        }

        // Cargar respuestas existentes
        function loadExistingResponses() {
            for (let key in urlParams) {
                if (key.startsWith('A')) {
                    const questionNum = parseInt(key.substring(1));
                    const score = parseFloat(urlParams[key]);
                    responses[questionNum - 1] = score;
                }
            }
        }

        // Inicializar encuesta
        function initializeSurvey() {
            allQuestions = [];
            
            surveyConfig.categories.forEach((category, categoryIndex) => {
                category.questions.forEach((question, questionIndex) => {
                    allQuestions.push({
                        text: question,
                        categoryIndex: categoryIndex,
                        categoryName: category.name,
                        categoryKey: category.key,
                        categoryColor: category.color
                    });
                });
            });

            // Si hay respuestas cargadas, ir a la primera pregunta sin respuesta
            if (Object.keys(responses).length > 0) {
                for (let i = 0; i < allQuestions.length; i++) {
                    if (responses[i] === undefined) {
                        currentQuestionIndex = i;
                        break;
                    }
                }
                // Si todas están respondidas, mostrar resultados
                if (Object.keys(responses).length === allQuestions.length) {
                    showResults();
                    return;
                }
            }

            // Solo actualizar progreso, no los botones aún
            updateProgress();
        }

        // Mostrar pregunta actual - SIN LLAMADAS A NAVEGACIÓN
        function showCurrentQuestion() {
            if (currentQuestionIndex >= allQuestions.length) {
                showResults();
                return;
            }

            const question = allQuestions[currentQuestionIndex];
            const questionSection = document.getElementById('questionSection');
            
            // Asegurar que la sección de preguntas esté visible
            if (questionSection) {
                questionSection.style.display = 'block';
            }
            
            // Actualizar contenido
            const categoryBadge = document.getElementById('categoryBadge');
            const questionNumber = document.getElementById('questionNumber');
            const questionText = document.getElementById('questionText');
            
            if (categoryBadge) {
                categoryBadge.textContent = question.categoryName;
                categoryBadge.style.background = `linear-gradient(135deg, ${question.categoryColor}, ${adjustBrightness(question.categoryColor, -20)})`;
            }
            
            if (questionNumber) {
                questionNumber.textContent = `Pregunta ${currentQuestionIndex + 1} de ${allQuestions.length}`;
            }
            
            if (questionText) {
                questionText.textContent = question.text;
            }

            // Generar escala de rating
            const ratingScale = document.getElementById('ratingScale');
            if (ratingScale) {
                ratingScale.innerHTML = '';
                
                for (let i = 1; i <= 10; i++) {
                    const ratingItem = document.createElement('div');
                    ratingItem.className = 'rating-item';
                    ratingItem.textContent = i;
                    ratingItem.dataset.value = i;
                    
                    // Marcar respuesta existente
                    if (responses[currentQuestionIndex] === i) {
                        ratingItem.classList.add('selected');
                    }
                    
                    // Agregar event listener directamente
                    ratingItem.addEventListener('click', function(e) {
                        const value = parseInt(e.target.dataset.value);
                        selectRating(value);
                    });
                    
                    ratingScale.appendChild(ratingItem);
                }
            }

            // Solo actualizar progreso (esto siempre funciona)
            updateProgress();

            // Animación
            if (questionSection) {
                questionSection.classList.add('fade-in');
                setTimeout(() => {
                    questionSection.classList.remove('fade-in');
                }, 500);
            }
        }

        // Seleccionar rating
        function selectRating(value) {
            console.log('Seleccionando rating:', value);
            
            // Remover selección previa
            document.querySelectorAll('.rating-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Agregar selección actual
            const selectedItem = document.querySelector(`[data-value="${value}"]`);
            if (selectedItem) {
                selectedItem.classList.add('selected');
            }
            
            // Guardar respuesta
            responses[currentQuestionIndex] = value;
            console.log('Respuesta guardada. Total respuestas:', Object.keys(responses).length);
            
            // NO llamar updateNavigationButtons aquí para evitar el error
            // updateNavigationButtons();
            
            // Avanzar automáticamente después de una pequeña pausa visual
            setTimeout(() => {
                if (currentQuestionIndex < allQuestions.length - 1) {
                    console.log('Avanzando a pregunta:', currentQuestionIndex + 1);
                    currentQuestionIndex++;
                    showCurrentQuestion();
                } else {
                    console.log('Última pregunta completada, mostrando resultados');
                    showResults();
                }
            }, 600);
        }

        // Pregunta siguiente
        function nextQuestion() {
            if (currentQuestionIndex < allQuestions.length - 1) {
                currentQuestionIndex++;
                showCurrentQuestion();
            } else {
                showResults();
            }
        }

        // Pregunta anterior
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showCurrentQuestion();
            }
        }

        // Actualizar botones de navegación
        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.disabled = responses[currentQuestionIndex] === undefined;
            
            // Cambiar texto del botón si es la última pregunta
            if (currentQuestionIndex === allQuestions.length - 1 && responses[currentQuestionIndex] !== undefined) {
                nextBtn.textContent = 'Ver Resultados →';
            } else {
                nextBtn.textContent = 'Siguiente →';
            }
        }

        // Actualizar progreso
        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / allQuestions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `Pregunta ${currentQuestionIndex + 1} de ${allQuestions.length}`;
        }

        // Mostrar resultados
        function showResults() {
            document.getElementById('questionSection').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'block';
            
            // Dar tiempo para que el DOM se actualice antes de crear el gráfico
            setTimeout(() => {
                calculateCategoryScores();
                createRadarChart();
                createScoreCards();
                generateURL();
            }, 100);

            // Scroll suave a resultados
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Calcular puntuaciones por categoría
        function calculateCategoryScores() {
            const categoryScores = {};
            
            surveyConfig.categories.forEach((category, categoryIndex) => {
                const categoryQuestions = category.questions.length;
                let totalScore = 0;
                let questionsAnswered = 0;
                
                // Buscar respuestas correspondientes a esta categoría
                allQuestions.forEach((question, questionIndex) => {
                    if (question.categoryIndex === categoryIndex && responses[questionIndex] !== undefined) {
                        totalScore += responses[questionIndex];
                        questionsAnswered++;
                    }
                });
                
                // Calcular promedio o poner 0 si no hay respuestas
                categoryScores[category.key] = questionsAnswered > 0 ? (totalScore / questionsAnswered) : 0;
                
                console.log(`Categoría ${category.name}: ${questionsAnswered} respuestas, promedio: ${categoryScores[category.key]}`);
            });
            
            return categoryScores;
        }

        // Crear gráfico de radar - SIN ERRORES
        function createRadarChart() {
            const categoryScores = calculateCategoryScores();
            const ctx = document.getElementById('radarChart');
            
            if (!ctx) {
                console.log('Canvas no encontrado para el gráfico');
                return;
            }
            
            const context = ctx.getContext('2d');
            
            // Destruir gráfico anterior si existe y es válido
            if (window.radarChart && typeof window.radarChart.destroy === 'function') {
                try {
                    window.radarChart.destroy();
                } catch (e) {
                    console.log('Error destruyendo gráfico anterior (ignorado)');
                }
            }
            
            const labels = surveyConfig.categories.map(cat => cat.name);
            const data = surveyConfig.categories.map(cat => categoryScores[cat.key] || 0);
            const colors = surveyConfig.categories.map(cat => cat.color);
            
            console.log('Datos del gráfico:', { labels, data, colors });
            
            // Verificar que tenemos datos válidos
            if (!labels.length || !data.length) {
                console.error('No hay datos para el gráfico');
                const chartContainer = document.querySelector('.chart-container');
                if (chartContainer) {
                    chartContainer.innerHTML = '<p style="text-align: center; color: #e74c3c; padding: 40px;">No hay datos suficientes para mostrar el gráfico.</p>';
                }
                return;
            }
            
            try {
                // Verificar que Chart.js está disponible
                if (typeof Chart === 'undefined') {
                    throw new Error('Chart.js no está cargado');
                }
                
                window.radarChart = new Chart(context, {
                    type: 'radar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Tu Puntuación',
                            data: data,
                            backgroundColor: 'rgba(52, 152, 219, 0.2)',
                            borderColor: '#3498db',
                            borderWidth: 3,
                            pointBackgroundColor: colors,
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 8,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 10,
                                min: 0,
                                ticks: {
                                    stepSize: 2,
                                    font: {
                                        size: 12
                                    },
                                    color: '#666',
                                    backdropColor: 'transparent'
                                },
                                pointLabels: {
                                    font: {
                                        size: 13,
                                        weight: 'bold'
                                    },
                                    color: '#2c3e50'
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                },
                                angleLines: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        elements: {
                            line: {
                                tension: 0
                            }
                        }
                    }
                });
                
                console.log('Gráfico creado exitosamente');
                
            } catch (error) {
                console.error('Error creando el gráfico:', error);
                // Fallback: mostrar mensaje de error
                const chartContainer = document.querySelector('.chart-container');
                if (chartContainer) {
                    chartContainer.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <p style="color: #e74c3c; margin-bottom: 20px;">Error al cargar el gráfico visual.</p>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; max-width: 400px; margin: 0 auto;">
                                ${surveyConfig.categories.map((cat, i) => `
                                    <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                        <div style="font-weight: bold; font-size: 0.9em; color: #2c3e50; margin-bottom: 5px;">${cat.name}</div>
                                        <div style="font-size: 1.5em; font-weight: bold; color: ${cat.color};">${(categoryScores[cat.key] || 0).toFixed(1)}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
            }
        }

        // Crear tarjetas de puntuación
        function createScoreCards() {
            const categoryScores = calculateCategoryScores();
            const scoresGrid = document.getElementById('scoresGrid');
            scoresGrid.innerHTML = '';
            
            surveyConfig.categories.forEach(category => {
                const score = categoryScores[category.key];
                const scoreClass = score >= 8 ? 'score-excellent' : score >= 6 ? 'score-good' : 'score-needs-improvement';
                const scoreLabel = score >= 8 ? 'Excelente' : score >= 6 ? 'Bueno' : 'Necesita Mejora';
                
                const scoreCard = document.createElement('div');
                scoreCard.className = 'score-card slide-in';
                scoreCard.innerHTML = `
                    <h4>${category.name}</h4>
                    <div class="score-value ${scoreClass}">${score.toFixed(1)}</div>
                    <div class="score-label">${scoreLabel}</div>
                `;
                
                scoresGrid.appendChild(scoreCard);
            });
        }

        // Generar URL con parámetros
        function generateURL() {
            const baseUrl = window.location.origin + window.location.pathname;
            const params = new URLSearchParams();
            
            // Información del participante
            params.set('name', urlParams.name || 'Participante');
            params.set('roomId', urlParams.roomId || 'General');
            
            // Nombres de categorías
            const categoryNames = surveyConfig.categories.map(cat => cat.name);
            params.set('names', categoryNames.join(','));
            
            // Respuestas
            Object.keys(responses).forEach(questionIndex => {
                const questionNum = parseInt(questionIndex) + 1;
                params.set(`A${questionNum}`, responses[questionIndex]);
                params.set(`Q${questionNum}`, '10');
            });
            
            // Textos de preguntas
            allQuestions.forEach((question, index) => {
                params.set(`t${index + 1}`, question.text);
            });
            
            params.set('survey', '1');
            
            const fullUrl = `${baseUrl}?${params.toString()}`;
            document.getElementById('generatedUrl').textContent = fullUrl;
        }

        // Funciones auxiliares
        function adjustBrightness(hex, percent) {
            const num = parseInt(hex.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
        }

        function copyUrl() {
            const urlText = document.getElementById('generatedUrl').textContent;
            navigator.clipboard.writeText(urlText).then(() => {
                alert('✅ URL copiada al portapapeles');
            });
        }

        function resetSurvey() {
            responses = {};
            currentQuestionIndex = 0;
            
            // Resetear configuración a la original
            surveyConfig = JSON.parse(JSON.stringify(defaultSurveyConfig));
            
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('questionSection').style.display = 'block';
            
            // Re-inicializar con configuración por defecto
            initializeSurvey();
            showCurrentQuestion();
            window.scrollTo(0, 0);
        }

        function showUrlExamples() {
            const examples = document.getElementById('urlExamples');
            examples.style.display = examples.style.display === 'none' ? 'block' : 'none';
        }

        // Eliminar completamente la función updateNavigationButtons para evitar errores
        // La funcionalidad principal no la necesita
    </script>
</body>
</html>
