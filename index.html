<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluación de Desempeño Inmobiliario</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 600px;
            width: 100%;
            min-height: 500px;
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .progress-section {
            margin-bottom: 30px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #27ae60);
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-text {
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .question-section {
            text-align: center;
            margin: 40px 0;
        }

        .category-badge {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 20px;
            display: inline-block;
        }

        .question-number {
            font-size: 1.1em;
            color: #7f8c8d;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 1.3em;
            color: #2c3e50;
            margin-bottom: 30px;
            line-height: 1.4;
            font-weight: 500;
        }

        .rating-container {
            margin: 30px 0;
        }

        .rating-scale {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            margin-bottom: 15px;
            max-width: 500px;
            margin: 0 auto 15px auto;
        }

        .rating-item {
            width: 45px;
            height: 45px;
            border: 2px solid #bdc3c7;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            font-size: 1.1em;
            justify-self: center;
        }

        @media (max-width: 768px) {
            .rating-scale {
                grid-template-columns: repeat(5, 1fr);
                gap: 8px;
                max-width: 300px;
            }
            
            .rating-item {
                width: 50px;
                height: 50px;
            }
        }

        @media (max-width: 480px) {
            .rating-scale {
                grid-template-columns: repeat(5, 1fr);
                gap: 6px;
                max-width: 280px;
            }
            
            .rating-item {
                width: 45px;
                height: 45px;
                font-size: 1em;
            }
        }

        .rating-item:hover {
            transform: scale(1.15);
            border-color: #3498db;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .rating-item.selected {
            background: #3498db;
            color: white;
            border-color: #2980b9;
            transform: scale(1.1);
        }

        .rating-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #7f8c8d;
            margin: 15px 20px;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }

        .btn-secondary:hover {
            box-shadow: 0 8px 20px rgba(149, 165, 166, 0.3);
        }

        .results-section {
            text-align: center;
            display: none;
        }

        .results-header {
            margin-bottom: 30px;
        }

        .results-header h2 {
            color: #2c3e50;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .chart-container {
            margin: 30px 0;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
        }

        .scores-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .score-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .score-card h4 {
            color: #2c3e50;
            font-size: 0.9em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .score-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }

        .score-excellent { color: #27ae60; }
        .score-good { color: #f39c12; }
        .score-needs-improvement { color: #e74c3c; }

        .score-label {
            font-size: 0.8em;
            color: #7f8c8d;
            font-weight: 500;
        }

        .url-section {
            background: #ecf0f1;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }

        .url-section h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .generated-url {
            background: white;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            word-break: break-all;
            border: 1px solid #bdc3c7;
            font-size: 0.9em;
        }

        .actions {
            margin-top: 20px;
            text-align: center;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in {
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Evaluación Inmobiliaria</h1>
            <p>Evalúa tu desempeño paso a paso</p>
        </div>

        <div class="progress-section">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text">
                <span id="progressText">Pregunta 0 de 0</span>
            </div>
        </div>

        <!-- Sección de preguntas -->
        <div class="question-section" id="questionSection">
            <div class="category-badge" id="categoryBadge"></div>
            <div class="question-number" id="questionNumber"></div>
            <div class="question-text" id="questionText"></div>
            
            <div class="rating-container">
                <div class="rating-scale" id="ratingScale">
                    <!-- Los botones de rating se generan dinámicamente -->
                </div>
                <div class="rating-labels">
                    <span>Muy bajo</span>
                    <span>Excelente</span>
                </div>
            </div>

            <div class="navigation">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()" disabled>
                    ← Anterior
                </button>
                <button class="btn" id="nextBtn" onclick="nextQuestion()" disabled>
                    Siguiente →
                </button>
            </div>
        </div>

        <!-- Sección de resultados -->
        <div class="results-section" id="resultsSection">
            <div class="results-header">
                <h2>Tus Resultados</h2>
                <p>Análisis de tu desempeño por área</p>
            </div>

            <div class="chart-container">
                <canvas id="radarChart" width="400" height="400"></canvas>
            </div>

            <div class="scores-grid" id="scoresGrid">
                <!-- Los scores se generan dinámicamente -->
            </div>

            <div class="url-section">
                <h3>URL de esta Evaluación</h3>
                <div class="generated-url" id="generatedUrl"></div>
                <div class="actions">
                    <button class="btn" onclick="copyUrl()">📋 Copiar URL</button>
                    <button class="btn btn-secondary" onclick="resetSurvey()">🔄 Nueva Evaluación</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuración del sistema
        const surveyConfig = {
            categories: [
                {
                    key: 'captacion',
                    name: 'Captación de Propiedades',
                    color: '#3498db',
                    questions: [
                        'Tengo una estrategia clara para identificar propiedades con potencial de venta',
                        'Mantengo relaciones sólidas con propietarios que pueden referir nuevas propiedades',
                        'Utilizo múltiples canales para encontrar nuevas propiedades (online, networking, referencias)'
                    ]
                },
                {
                    key: 'leads',
                    name: 'Generación y Gestión de Leads',
                    color: '#27ae60',
                    questions: [
                        'Genero consistentemente nuevos leads calificados cada semana',
                        'Tengo un sistema organizado para dar seguimiento a todos mis leads',
                        'Convierto efectivamente leads fríos en clientes interesados'
                    ]
                },
                {
                    key: 'productividad',
                    name: 'Productividad Personal y del Equipo',
                    color: '#f39c12',
                    questions: [
                        'Gestiono eficientemente mi tiempo y priorizo las actividades de mayor impacto',
                        'Utilizo tecnología y herramientas para optimizar mis procesos de trabajo',
                        'Colaboro efectivamente con mi equipo para maximizar resultados'
                    ]
                },
                {
                    key: 'conversion',
                    name: 'Conversión de Operaciones',
                    color: '#e74c3c',
                    questions: [
                        'Cierro efectivamente las negociaciones y concreto las ventas',
                        'Manejo objeciones de clientes de manera profesional y convincente',
                        'Mantengo una tasa de conversión consistente de prospectos a clientes'
                    ]
                }
            ]
        };

        // Variables globales
        let currentQuestionIndex = 0;
        let responses = {};
        let allQuestions = [];
        let urlParams = {};

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            parseURLParams();
            initializeSurvey();
            showCurrentQuestion();
        });

        // Parsear parámetros de URL
        function parseURLParams() {
            const params = new URLSearchParams(window.location.search);
            urlParams = {};
            
            for (let [key, value] of params) {
                urlParams[key] = decodeURIComponent(value);
            }

            // Cargar respuestas existentes si existen
            if (Object.keys(urlParams).length > 0) {
                loadExistingResponses();
            }
        }

        // Cargar respuestas existentes
        function loadExistingResponses() {
            for (let key in urlParams) {
                if (key.startsWith('A')) {
                    const questionNum = parseInt(key.substring(1));
                    const score = parseFloat(urlParams[key]);
                    responses[questionNum - 1] = score;
                }
            }
        }

        // Inicializar encuesta
        function initializeSurvey() {
            allQuestions = [];
            
            surveyConfig.categories.forEach((category, categoryIndex) => {
                category.questions.forEach((question, questionIndex) => {
                    allQuestions.push({
                        text: question,
                        categoryIndex: categoryIndex,
                        categoryName: category.name,
                        categoryKey: category.key,
                        categoryColor: category.color
                    });
                });
            });

            // Si hay respuestas cargadas, ir a la primera pregunta sin respuesta
            if (Object.keys(responses).length > 0) {
                for (let i = 0; i < allQuestions.length; i++) {
                    if (responses[i] === undefined) {
                        currentQuestionIndex = i;
                        break;
                    }
                }
                // Si todas están respondidas, mostrar resultados
                if (Object.keys(responses).length === allQuestions.length) {
                    showResults();
                    return;
                }
            }

            updateProgress();
        }

        // Mostrar pregunta actual
        function showCurrentQuestion() {
            if (currentQuestionIndex >= allQuestions.length) {
                showResults();
                return;
            }

            const question = allQuestions[currentQuestionIndex];
            const questionSection = document.getElementById('questionSection');
            
            // Actualizar contenido
            document.getElementById('categoryBadge').textContent = question.categoryName;
            document.getElementById('categoryBadge').style.background = `linear-gradient(135deg, ${question.categoryColor}, ${adjustBrightness(question.categoryColor, -20)})`;
            document.getElementById('questionNumber').textContent = `Pregunta ${currentQuestionIndex + 1} de ${allQuestions.length}`;
            document.getElementById('questionText').textContent = question.text;

            // Generar escala de rating
            const ratingScale = document.getElementById('ratingScale');
            ratingScale.innerHTML = '';
            
            for (let i = 1; i <= 10; i++) {
                const ratingItem = document.createElement('div');
                ratingItem.className = 'rating-item';
                ratingItem.textContent = i;
                ratingItem.dataset.value = i;
                
                // Marcar respuesta existente
                if (responses[currentQuestionIndex] === i) {
                    ratingItem.classList.add('selected');
                }
                
                ratingItem.addEventListener('click', function() {
                    selectRating(i);
                });
                
                ratingScale.appendChild(ratingItem);
            }

            // Actualizar botones de navegación
            updateNavigationButtons();
            updateProgress();

            // Animación
            questionSection.classList.add('fade-in');
            setTimeout(() => {
                questionSection.classList.remove('fade-in');
            }, 500);
        }

        // Seleccionar rating
        function selectRating(value) {
            // Remover selección previa
            document.querySelectorAll('.rating-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Agregar selección actual
            document.querySelector(`[data-value="${value}"]`).classList.add('selected');
            
            // Guardar respuesta
            responses[currentQuestionIndex] = value;
            
            // Habilitar botón siguiente
            document.getElementById('nextBtn').disabled = false;
        }

        // Pregunta siguiente
        function nextQuestion() {
            if (currentQuestionIndex < allQuestions.length - 1) {
                currentQuestionIndex++;
                showCurrentQuestion();
            } else {
                showResults();
            }
        }

        // Pregunta anterior
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showCurrentQuestion();
            }
        }

        // Actualizar botones de navegación
        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.disabled = responses[currentQuestionIndex] === undefined;
            
            // Cambiar texto del botón si es la última pregunta
            if (currentQuestionIndex === allQuestions.length - 1 && responses[currentQuestionIndex] !== undefined) {
                nextBtn.textContent = 'Ver Resultados →';
            } else {
                nextBtn.textContent = 'Siguiente →';
            }
        }

        // Actualizar progreso
        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / allQuestions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `Pregunta ${currentQuestionIndex + 1} de ${allQuestions.length}`;
        }

        // Mostrar resultados
        function showResults() {
            document.getElementById('questionSection').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'block';
            
            calculateCategoryScores();
            createRadarChart();
            createScoreCards();
            generateURL();

            // Scroll suave a resultados
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Calcular puntuaciones por categoría
        function calculateCategoryScores() {
            const categoryScores = {};
            
            surveyConfig.categories.forEach((category, categoryIndex) => {
                const categoryQuestions = category.questions.length;
                let totalScore = 0;
                let questionsInCategory = 0;
                
                allQuestions.forEach((question, questionIndex) => {
                    if (question.categoryIndex === categoryIndex && responses[questionIndex] !== undefined) {
                        totalScore += responses[questionIndex];
                        questionsInCategory++;
                    }
                });
                
                categoryScores[category.key] = questionsInCategory > 0 ? totalScore / questionsInCategory : 0;
            });
            
            return categoryScores;
        }

        // Crear gráfico de radar
        function createRadarChart() {
            const categoryScores = calculateCategoryScores();
            const ctx = document.getElementById('radarChart').getContext('2d');
            
            // Destruir gráfico anterior si existe
            if (window.radarChart) {
                window.radarChart.destroy();
            }
            
            const labels = surveyConfig.categories.map(cat => cat.name);
            const data = surveyConfig.categories.map(cat => categoryScores[cat.key]);
            const colors = surveyConfig.categories.map(cat => cat.color);
            
            window.radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Tu Puntuación',
                        data: data,
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderColor: '#3498db',
                        borderWidth: 3,
                        pointBackgroundColor: colors,
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10,
                            min: 0,
                            ticks: {
                                stepSize: 2,
                                font: {
                                    size: 12
                                }
                            },
                            pointLabels: {
                                font: {
                                    size: 13,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Crear tarjetas de puntuación
        function createScoreCards() {
            const categoryScores = calculateCategoryScores();
            const scoresGrid = document.getElementById('scoresGrid');
            scoresGrid.innerHTML = '';
            
            surveyConfig.categories.forEach(category => {
                const score = categoryScores[category.key];
                const scoreClass = score >= 8 ? 'score-excellent' : score >= 6 ? 'score-good' : 'score-needs-improvement';
                const scoreLabel = score >= 8 ? 'Excelente' : score >= 6 ? 'Bueno' : 'Necesita Mejora';
                
                const scoreCard = document.createElement('div');
                scoreCard.className = 'score-card slide-in';
                scoreCard.innerHTML = `
                    <h4>${category.name}</h4>
                    <div class="score-value ${scoreClass}">${score.toFixed(1)}</div>
                    <div class="score-label">${scoreLabel}</div>
                `;
                
                scoresGrid.appendChild(scoreCard);
            });
        }

        // Generar URL con parámetros
        function generateURL() {
            const baseUrl = window.location.origin + window.location.pathname;
            const params = new URLSearchParams();
            
            // Información del participante
            params.set('name', urlParams.name || 'Participante');
            params.set('roomId', urlParams.roomId || 'General');
            
            // Nombres de categorías
            const categoryNames = surveyConfig.categories.map(cat => cat.name);
            params.set('names', categoryNames.join(','));
            
            // Respuestas
            Object.keys(responses).forEach(questionIndex => {
                const questionNum = parseInt(questionIndex) + 1;
                params.set(`A${questionNum}`, responses[questionIndex]);
                params.set(`Q${questionNum}`, '10');
            });
            
            // Textos de preguntas
            allQuestions.forEach((question, index) => {
                params.set(`t${index + 1}`, question.text);
            });
            
            params.set('survey', '1');
            
            const fullUrl = `${baseUrl}?${params.toString()}`;
            document.getElementById('generatedUrl').textContent = fullUrl;
        }

        // Funciones auxiliares
        function adjustBrightness(hex, percent) {
            const num = parseInt(hex.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
        }

        function copyUrl() {
            const urlText = document.getElementById('generatedUrl').textContent;
            navigator.clipboard.writeText(urlText).then(() => {
                alert('✅ URL copiada al portapapeles');
            });
        }

        function resetSurvey() {
            responses = {};
            currentQuestionIndex = 0;
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('questionSection').style.display = 'block';
            showCurrentQuestion();
            window.scrollTo(0, 0);
        }
    </script>
</body>
</html>
